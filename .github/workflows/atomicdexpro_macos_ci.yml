name: AtomicDEX Pro MacOS CI

on: [pull_request, push]

jobs:

  macos-build:
    name: MacOS Build
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install QT (MacOS)
        uses: jurplel/install-qt-action@v2
        with:
          version: '5.14.1'
          host: 'mac'
          target: 'desktop'
          dir: '${{ github.workspace }}'
          modules: 'qtcharts qtwidgets debug_info'

      - name: Install deps (MacOS)
        run: |
          ls -la ${{ github.workspace }}/Qt/5.14.1/clang_64/lib/cmake
          brew update
          brew upgrade
          brew install autoconf \
                       automake \
                       libtool \
                       pkgconfig \
                       wget \
                       nim \
                       cmake \
                       ninja \
                       git \
                       boost \
                       gcc

          # get libbitcoin
          git clone --depth 1 --branch version4 --single-branch "https://github.com/libbitcoin/secp256k1"
          cd secp256k1
          ./autogen.sh
          ./configure
          sudo make install  --disable-shared
          cd ../

          git clone --depth 1 --branch version3 --single-branch https://github.com/KomodoPlatform/libbitcoin-system.git
          cd libbitcoin-system
          ./autogen.sh
          ./configure
          sudo make install --build-boost --disable-shared
          sudo ldconfig

      - name: Build (MacOS)
        env:
          QT_INSTALL_CMAKE_PATH: ${{ github.workspace }}/Qt/5.14.1/clang_64/lib/cmake
          QT_ROOT: ${{ github.workspace }}/Qt/5.14.1
        run: |
          cd ci_tools_atomic_dex
          ls -la
          nimble build -y
          ./ci_tools_atomic_dex build debug
          ls -la build-*
          ./ci_tools_atomic_dex bundle debug
          ls -la bundle-*

#      - name: Upload artifacts (MacOS)
#        uses: actions/upload-artifact@v1
#        with:
#          name: atomicdexpro-linux.tar.gz
#          path: ./tbd
